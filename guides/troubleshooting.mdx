---
title: Troubleshooting
description: Common issues and solutions for BlueLibs Runner applications
---

When things go wrong, this guide helps you identify and fix common Runner issues quickly.

## Quick Error Reference

<AccordionGroup>
  <Accordion title="TypeError: X is not a function" icon="exclamation-triangle">
    **Symptom:** Task call fails at runtime

    **Likely Cause:** Forgot `.build()` on task/resource definition

    **Fix:**
    ```typescript
    // Wrong
    const myTask = r.task("app.task").run(async () => {});

    // Correct
    const myTask = r.task("app.task").run(async () => {}).build();
    ```
  </Accordion>

  <Accordion title="Resource 'X' not found" icon="exclamation-triangle">
    **Symptom:** Runtime crash during initialization

    **Likely Cause:** Component not registered

    **Fix:**
    ```typescript
    const database = r.resource("app.db").build();
    const myTask = r.task("app.task").dependencies({ database }).build();

    // Wrong - database not registered
    const app = r.resource("app").register([myTask]).build();

    // Correct - both registered
    const app = r.resource("app").register([database, myTask]).build();
    ```
  </Accordion>

  <Accordion title="Config validation failed for X" icon="exclamation-triangle">
    **Symptom:** Startup crash before app runs

    **Likely Cause:** Missing `.with()` config for resource

    **Fix:**
    ```typescript
    const server = r
      .resource<{ port: number }>("app.server")
      .init(async ({ port }) => startServer(port))
      .build();

    // Wrong - no config provided
    const app = r.resource("app").register([server]).build();

    // Correct - config provided
    const app = r.resource("app").register([server.with({ port: 3000 })]).build();
    ```
  </Accordion>

  <Accordion title="Visibility violation error" icon="exclamation-triangle">
    **Symptom:** `run(app)` fails with `runner.errors.visibilityViolation`

    **Likely Cause:** Cross-resource reference to a non-exported item

    **Fix:**
    ```typescript
    const internalTask = r.task("billing.internal").run(async () => 1).build();
    const publicTask = r.task("billing.public").run(async () => 2).build();

    const billing = r
      .resource("billing")
      .register([internalTask, publicTask])
      .exports([publicTask]) // Only publicTask is accessible outside
      .build();

    // Wrong - trying to depend on non-exported item
    const app = r
      .resource("app")
      .register([billing])
      .dependencies({ internalTask }) // Error!
      .build();

    // Correct - depend on exported item
    const app = r
      .resource("app")
      .register([billing])
      .dependencies({ publicTask })
      .build();
    ```
  </Accordion>

  <Accordion title="Circular dependency detected" icon="exclamation-triangle">
    **Symptom:** `run(app)` fails or TypeScript inference fails

    **Likely Cause:** Actual dependency cycle or import cycle

    **Fix for runtime cycle:**
    Break the dependency loop across tasks/resources:
    ```typescript
    // Bad - A depends on B, B depends on A
    const resourceA = r.resource("a").dependencies({ resourceB }).build();
    const resourceB = r.resource("b").dependencies({ resourceA }).build();

    // Good - Break the cycle
    const shared = r.resource("shared").build();
    const resourceA = r.resource("a").dependencies({ shared }).build();
    const resourceB = r.resource("b").dependencies({ shared }).build();
    ```

    **Fix for type inference cycle:**
    Use explicit type annotation:
    ```typescript
    import type { IResource } from "@bluelibs/runner";

    const resourceA = r
      .resource("a")
      .dependencies({ resourceB })
      .build() as IResource<void, { value: string }>;
    ```
  </Accordion>

  <Accordion title="TimeoutError" icon="exclamation-triangle">
    **Symptom:** Task hangs then throws

    **Likely Cause:** Operation exceeded timeout TTL

    **Fix:**
    ```typescript
    // Increase timeout or investigate slow operation
    const slowTask = r
      .task("app.slow")
      .middleware([
        globals.middleware.task.timeout.with({ ttl: 10000 }), // Increase from 5s to 10s
      ])
      .run(async () => await slowOperation())
      .build();
    ```
  </Accordion>

  <Accordion title="Cannot read property 'X' of undefined" icon="exclamation-triangle">
    **Symptom:** Task crashes mid-execution

    **Likely Cause:** Dependency not properly injected

    **Fix:**
    ```typescript
    // Check dependencies match what you use
    const myTask = r
      .task("app.task")
      .dependencies({ db, logger }) // Must declare all dependencies
      .run(async (input, { db, logger }) => {
        // Both db and logger are available
      })
      .build();
    ```
  </Accordion>
</AccordionGroup>

## Common First Failures

<Note>
  New to Runner? These are mistakes everyone makes when learning the framework.
</Note>

### Forgot `.build()`

```typescript
// Wrong - returns a builder, not a usable task
const myTask = r.task("app.task").run(async () => "hello");

// Correct - returns the actual task
const myTask = r
  .task("app.task")
  .run(async () => "hello")
  .build(); // Required!
```

**Symptom:** `TypeError: myTask is not a function` or strange type errors.

### Forgot to Register

```typescript
const database = r.resource("app.db").init(async () => connection).build();
const myTask = r
  .task("app.task")
  .dependencies({ database })
  .run(async (_, { database }) => database.query())
  .build();

// Wrong - myTask depends on database but database isn't registered
const app = r.resource("app").register([myTask]).build();

// Correct - register ALL components
const app = r.resource("app").register([database, myTask]).build();
```

**Remember:** `dependencies` says "I need these" — `register` says "these exist".

### Missing `.with()` Config

```typescript
// Resource requires configuration
const server = r
  .resource<{ port: number }>("app.server")
  .init(async ({ port }) => startServer(port))
  .build();

// Wrong - no config provided (TypeScript error)
const app = r.resource("app").register([server]).build();

// Correct - provide config with .with()
const app = r
  .resource("app")
  .register([server.with({ port: 3000 })])
  .build();
```

### Calling Task Before Runtime

```typescript
// Wrong - can't call task directly without runtime
const result = await myTask({ input: "data" }); // Fails!

// Correct - get runtime first, then call
const { runTask, dispose } = await run(app);
const result = await runTask(myTask, { input: "data" });
await dispose();
```

## Debug Mode

Enable verbose debugging to see what's happening:

```typescript
import { run } from "@bluelibs/runner";

const { runTask, dispose } = await run(app, {
  debug: "verbose",
  logs: { printThreshold: "debug" },
});
```

**What you'll see:**

```
[DEBUG] [runner] Initializing resource: app.database
[DEBUG] [runner] Resource initialized: app.database (12ms)
[DEBUG] [runner] Executing task: app.tasks.createUser
[DEBUG] [runner]   Input: { "name": "Ada", "email": "ada@example.com" }
[DEBUG] [runner]   Result: { "id": "user-123", "name": "Ada" }
[DEBUG] [runner] Task completed: app.tasks.createUser (5ms)
```

### Debug Levels

| Level | What's Logged |
|-------|---------------|
| `"normal"` | Lifecycle events, errors, event emissions |
| `"verbose"` | All of above + task inputs/outputs, resource configs |

### Per-Component Debugging

```typescript
import { globals } from "@bluelibs/runner";

const criticalTask = r
  .task("app.payment")
  .tags([globals.tags.debug.with({ logTaskInput: true, logTaskOutput: true })])
  .run(async (input) => processPayment(input))
  .build();
```

## Lifecycle Issues

<AccordionGroup>
  <Accordion title="Resources not disposing properly" icon="trash">
    **Symptom:** Hanging process, "port already in use" on restart, connection leaks

    **Fix:** Ensure every resource with setup has matching cleanup:

    ```typescript
    const server = r
      .resource<{ port: number }>("app.server")
      .init(async ({ port }) => {
        const app = express();
        const listener = app.listen(port);
        return { app, listener };
      })
      .dispose(async ({ listener }) => {
        // Don't forget this!
        return new Promise((resolve) => listener.close(resolve));
      })
      .build();
    ```
  </Accordion>

  <Accordion title="Shutdown hanging forever" icon="hourglass">
    **Symptom:** `dispose()` never resolves

    **Likely causes:**
    1. Dispose function has unresolved promise
    2. Resource left open handles (timers/sockets)
    3. Circular await in dispose chain

    **Debug approach:**
    ```typescript
    const { dispose } = await run(app);

    // Add timeout to identify hanging dispose
    const timeout = setTimeout(() => {
      console.error("Dispose hanging - check resource cleanup");
      process.exit(1);
    }, 10000);

    await dispose();
    clearTimeout(timeout);
    ```
  </Accordion>
</AccordionGroup>

## Performance Issues

<AccordionGroup>
  <Accordion title="Slow task execution" icon="gauge">
    **Check middleware order** — faster middleware should come first:

    ```typescript
    // Good - fast checks first
    .middleware([
      authCheck,        // ~0.1ms - fails fast if unauthorized
      rateLimit,        // ~0.5ms - blocks before expensive work
      timeout,          // wraps the slow stuff
      expensiveLogging, // can afford to be slow
    ])
    ```
  </Accordion>

  <Accordion title="Missing cache hits" icon="memory">
    Enable verbose logging to see cache behavior:

    ```typescript
    await run(app, { debug: "verbose" });
    // Watch for: "Cache miss for app.tasks.expensive" vs "Cache hit"
    ```
  </Accordion>

  <Accordion title="Slow initialization" icon="stopwatch">
    Profile startup time:

    ```typescript
    const start = Date.now();
    const { dispose } = await run(app);
    console.log(`App initialized in ${Date.now() - start}ms`);
    ```

    **Common causes:**
    - Sequential resource initialization (use `initMode: "parallel"`)
    - Expensive operations in `init()` functions
    - Network calls during startup
  </Accordion>
</AccordionGroup>

## TypeScript Issues

<AccordionGroup>
  <Accordion title="Circular type inference" icon="arrows-spin">
    **Symptom:** TypeScript shows `any` or fails to infer types in circular imports

    **Solution:** Explicitly type the resource that closes the loop:

    ```typescript
    import type { IResource } from "@bluelibs/runner";

    export const problematicResource = r
      .resource("app.problematic")
      .dependencies({ otherResource })
      .init(async (_, { otherResource }) => {
        return { value: otherResource.something };
      })
      .build() as IResource<void, { value: string }>;
    ```
  </Accordion>

  <Accordion title="Type errors with middleware contracts" icon="file-contract">
    **Symptom:** Task input/output types don't match middleware expectations

    **Fix:** Ensure task satisfies all middleware contracts:

    ```typescript
    // Middleware expects { user: { role: string } } input
    const authMiddleware = r.middleware.task<
      { requiredRole: string },
      { user: { role: string } },
      unknown
    >("auth");

    // Task MUST have compatible input type
    const adminTask = r
      .task("admin")
      .middleware([authMiddleware.with({ requiredRole: "admin" })])
      .run(async (input: { user: { role: string }; /* other fields */ }) => {
        // input.user.role is available and typed
      })
      .build();
    ```
  </Accordion>
</AccordionGroup>

## Platform-Specific Issues

<AccordionGroup>
  <Accordion title="AsyncLocalStorage not available (Browser/Edge)" icon="browser">
    **Symptom:** `PlatformUnsupportedFunction` when using async context

    **Cause:** Async context requires Node.js `AsyncLocalStorage`

    **Solution:** Use Node.js or redesign to avoid request-scoped state:

    ```typescript
    // Only works in Node.js
    const requestContext = r
      .asyncContext<{ requestId: string }>("app.ctx.request")
      .build();

    // In browser/edge, pass context explicitly instead
    const myTask = r
      .task("app.task")
      .run(async (input: { requestId: string; data: any }) => {
        // Use input.requestId instead of context
      })
      .build();
    ```
  </Accordion>

  <Accordion title="Durable workflows fail (non-Node)" icon="workflow">
    **Symptom:** Import error or runtime error when using durable workflows

    **Cause:** Durable workflows are Node.js-only (`@bluelibs/runner/node`)

    **Solution:** Use Node.js runtime for durable workflows, or redesign using tasks + external job queue.
  </Accordion>
</AccordionGroup>

## Filing a Good Issue

When you need help, include this information:

```markdown
## Environment

- @bluelibs/runner version: X.X.X
- Node.js version: X.X.X
- TypeScript version: X.X.X
- OS: macOS/Windows/Linux

## Minimal Reproduction

```typescript
// Smallest possible code that reproduces the issue
import { r, run } from "@bluelibs/runner";

const app = r.resource("app").build();
await run(app); // Describe what goes wrong here
```

## Expected Behavior

What should happen.

## Actual Behavior

What actually happens.

## Error Output

```
Full stack trace here
```

## Debug Logs

```
Output from: await run(app, { debug: "verbose" })
```
```

**Get your version:**

```bash
npm ls @bluelibs/runner
```

**Pro tips:**
- Minimal reproduction > walls of code
- Stack traces > "it doesn't work"
- Debug logs often reveal the issue before you file

## Additional Resources

<CardGroup cols={2}>
  <Card title="GitHub Issues" icon="github" href="https://github.com/bluelibs/runner/issues">
    Search existing issues or file a new one
  </Card>
  <Card title="Examples" icon="code" href="https://github.com/bluelibs/runner/tree/main/examples">
    Reference working examples
  </Card>
  <Card title="Migration Guide" icon="arrow-right" href="/guides/migration">
    Upgrading between versions
  </Card>
  <Card title="Production Readiness" icon="check" href="/guides/production-readiness">
    Pre-deployment checklist
  </Card>
</CardGroup>

## Still Stuck?

1. **Search existing issues:** [GitHub Issues](https://github.com/bluelibs/runner/issues)
2. **Check examples:** [Examples directory](https://github.com/bluelibs/runner/tree/main/examples)
3. **Ask the AI:** [Runner Chatbot](https://chatgpt.com/g/g-68b756abec648191aa43eaa1ea7a7945-runner)
4. **Open an issue:** [New Issue](https://github.com/bluelibs/runner/issues/new)
5. **Enterprise support:** [Contact us](/guides/production-readiness)